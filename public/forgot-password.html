<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BuscaBusca — Recuperar senha</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">

  <div class="w-full max-w-md">
    <!-- Logo / Brand -->
    <div class="text-center mb-8">
      <div class="inline-flex items-center justify-center w-14 h-14 bg-indigo-600 rounded-2xl shadow-lg mb-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 21v-7.5a.75.75 0 01.75-.75h3a.75.75 0 01.75.75V21m-4.5 0H2.36m11.14 0H18m0 0h3.64m-1.39 0V9.349m-16.5 11.65V9.35m0 0a3.001 3.001 0 003.75-.615A2.993 2.993 0 009.75 9.75c.896 0 1.7-.393 2.25-1.016a2.993 2.993 0 002.25 1.016c.896 0 1.7-.393 2.25-1.016a3.001 3.001 0 003.75.614m-16.5 0a3.004 3.004 0 01-.621-4.72L4.318 3.44A1.5 1.5 0 015.378 3h13.243a1.5 1.5 0 011.06.44l1.19 1.189a3 3 0 01-.621 4.72m-13.5 8.65h3.75a.75.75 0 00.75-.75V13.5a.75.75 0 00-.75-.75H6.75a.75.75 0 00-.75.75v3.75c0 .415.336.75.75.75z" />
        </svg>
      </div>
      <h1 class="text-2xl font-bold text-gray-900">BuscaBusca</h1>
      <p class="text-gray-500 text-sm mt-1">Plataforma de Cadastro de Lojistas</p>
    </div>

    <!-- Card -->
    <div class="bg-white rounded-2xl shadow-xl p-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-2">Recuperar senha</h2>
      <p class="text-sm text-gray-500 mb-6">Informe seu e-mail para receber o token de recuperação.</p>

      <!-- Alerta -->
      <div id="alert" class="hidden mb-4 p-3 rounded-lg text-sm font-medium"></div>

      <!-- Formulário -->
      <div id="formSection">
        <form id="forgotForm" class="space-y-5">
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
            <input
              type="email"
              id="email"
              name="email"
              autocomplete="email"
              required
              placeholder="seu@email.com"
              class="w-full px-4 py-2.5 rounded-lg border border-gray-300 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition"
            >
          </div>

          <button
            type="submit"
            id="btnSubmit"
            class="w-full py-2.5 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-60 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
          >
            Gerar token de recuperação
          </button>
        </form>
      </div>

      <!-- Resultado (mock) -->
      <div id="resultSection" class="hidden">
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-5 mb-5">
          <div class="flex items-start gap-3">
            <div class="flex-shrink-0 mt-0.5">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-amber-600" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 1.998-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.502-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd" />
              </svg>
            </div>
            <div>
              <p class="text-sm font-semibold text-amber-800 mb-1">Modo demonstração (mock)</p>
              <p class="text-xs text-amber-700">Em produção, o token seria enviado por e-mail. Aqui ele é retornado diretamente para fins de teste.</p>
            </div>
          </div>
        </div>

        <div class="mb-5">
          <p class="text-sm font-medium text-gray-700 mb-2">Seu token de recuperação:</p>
          <div class="relative">
            <code id="resetTokenDisplay" class="block bg-gray-100 border border-gray-200 rounded-lg px-4 py-3 text-xs text-gray-800 font-mono break-all pr-12"></code>
            <button onclick="copyToken()" title="Copiar"
              class="absolute top-2 right-2 p-1.5 text-gray-400 hover:text-indigo-600 transition rounded">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
              </svg>
            </button>
          </div>
          <p id="copyMsg" class="hidden text-xs text-green-600 mt-1">Token copiado!</p>
        </div>

        <a id="resetLink" href="reset-password.html"
          class="block w-full py-2.5 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg text-center transition focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
          Usar token para redefinir senha
        </a>
      </div>

      <!-- Link voltar -->
      <p class="mt-6 text-center text-sm text-gray-600">
        Lembrou a senha?
        <a href="login.html" class="text-indigo-600 hover:text-indigo-800 font-medium transition">Entrar</a>
      </p>
    </div>
  </div>

  <script>
    let currentToken = null;

    function showAlert(message, type = 'error') {
      const el = document.getElementById('alert');
      el.textContent = message;
      el.className = type === 'error'
        ? 'mb-4 p-3 rounded-lg text-sm font-medium bg-red-50 text-red-700 border border-red-200'
        : 'mb-4 p-3 rounded-lg text-sm font-medium bg-green-50 text-green-700 border border-green-200';
      el.classList.remove('hidden');
    }

    function copyToken() {
      if (!currentToken) return;
      navigator.clipboard.writeText(currentToken).then(() => {
        const msg = document.getElementById('copyMsg');
        msg.classList.remove('hidden');
        setTimeout(() => msg.classList.add('hidden'), 2000);
      });
    }

    document.getElementById('forgotForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('btnSubmit');
      btn.disabled    = true;
      btn.textContent = 'Gerando token...';

      try {
        const res = await fetch('forgot-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: document.getElementById('email').value.trim() }),
        });

        const data = await res.json();

        if (data.success && data.data && data.data.reset_token) {
          currentToken = data.data.reset_token;
          document.getElementById('resetTokenDisplay').textContent = currentToken;
          document.getElementById('resetLink').href = '/reset-password.html?token=' + encodeURIComponent(currentToken);
          document.getElementById('formSection').classList.add('hidden');
          document.getElementById('resultSection').classList.remove('hidden');
        } else if (data.success) {
          showAlert('E-mail não encontrado no sistema', 'error');
          btn.disabled    = false;
          btn.textContent = 'Gerar token de recuperação';
        } else {
          showAlert(data.message || 'Erro ao processar solicitação');
          btn.disabled    = false;
          btn.textContent = 'Gerar token de recuperação';
        }
      } catch {
        showAlert('Erro de conexão. Tente novamente.');
        btn.disabled    = false;
        btn.textContent = 'Gerar token de recuperação';
      }
    });
  </script>
</body>
</html>
