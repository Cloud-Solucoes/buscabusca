<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BuscaBusca — Painel</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50">

  <!-- Nav Menu -->
  <nav class="bg-white border-b border-gray-200 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="flex items-center justify-between h-16">
        <!-- Logo + Links -->
        <div class="flex items-center gap-6">
          <a href="dashboard.html" class="flex items-center gap-2">
            <div class="inline-flex items-center justify-center w-9 h-9 bg-indigo-600 rounded-xl">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 21v-7.5a.75.75 0 01.75-.75h3a.75.75 0 01.75.75V21m-4.5 0H2.36m11.14 0H18m0 0h3.64m-1.39 0V9.349m-16.5 11.65V9.35m0 0a3.001 3.001 0 003.75-.615A2.993 2.993 0 009.75 9.75c.896 0 1.7-.393 2.25-1.016a2.993 2.993 0 002.25 1.016c.896 0 1.7-.393 2.25-1.016a3.001 3.001 0 003.75.614m-16.5 0a3.004 3.004 0 01-.621-4.72L4.318 3.44A1.5 1.5 0 015.378 3h13.243a1.5 1.5 0 011.06.44l1.19 1.189a3 3 0 01-.621 4.72m-13.5 8.65h3.75a.75.75 0 00.75-.75V13.5a.75.75 0 00-.75-.75H6.75a.75.75 0 00-.75.75v3.75c0 .415.336.75.75.75z" />
              </svg>
            </div>
            <span class="text-lg font-bold text-gray-900 hidden sm:inline">BuscaBusca</span>
          </a>

          <!-- Desktop Links -->
          <div class="hidden md:flex items-center gap-1">
            <a href="dashboard.html" class="flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium bg-indigo-50 text-indigo-700">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg>
              Dashboard
            </a>
            <a href="cadastro.html" class="flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
              Cadastro
            </a>
            <a href="swagger.html" class="flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" /></svg>
              API Docs
            </a>
          </div>
        </div>

        <!-- Right side -->
        <div class="flex items-center gap-3">
          <div class="hidden sm:flex items-center gap-2.5">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
            <div class="text-right">
              <p id="userNome" class="text-sm font-medium text-gray-800"></p>
              <p id="userEmail" class="text-xs text-gray-500"></p>
            </div>
          </div>
          <button onclick="logout()"
            class="flex items-center gap-1.5 text-sm text-gray-600 hover:text-red-600 transition font-medium px-3 py-1.5 rounded-lg hover:bg-red-50">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
            </svg>
            Sair
          </button>

          <!-- Mobile hamburger -->
          <button id="menuToggle" class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition" onclick="toggleMobileMenu()">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Mobile menu -->
      <div id="mobileMenu" class="md:hidden hidden border-t border-gray-100 py-2 pb-3">
        <a href="dashboard.html" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium bg-indigo-50 text-indigo-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg>
          Dashboard
        </a>
        <a href="cadastro.html" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
          Cadastro
        </a>
        <a href="swagger.html" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" /></svg>
          API Docs
        </a>
      </div>
    </div>
  </nav>

  <!-- Conteúdo -->
  <main class="max-w-6xl mx-auto px-4 sm:px-6 py-8">

    <!-- Alert de sucesso (vindo do cadastro) -->
    <div id="successAlert" class="hidden mb-6 p-3 rounded-lg text-sm font-medium bg-green-50 text-green-700 border border-green-200 flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span id="successMsg"></span>
    </div>

    <!-- Boas-vindas -->
    <div class="mb-8 flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Painel do Lojista</h1>
        <p class="text-gray-500 mt-1">Gerencie seus registros de lojistas.</p>
      </div>
      <a href="cadastro.html"
        class="hidden sm:inline-flex items-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold rounded-lg transition focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
        Novo Cadastro
      </a>
    </div>

    <!-- Cards de resumo -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
      <div class="bg-white rounded-xl border border-gray-200 p-5">
        <p class="text-sm text-gray-500 mb-1">Total de registros</p>
        <p id="totalRegistros" class="text-3xl font-bold text-indigo-600">—</p>
      </div>

      <!-- Donut: Empresas por Segmento -->
      <div class="bg-white rounded-xl border border-gray-200 p-5 sm:col-span-2">
        <p class="text-sm text-gray-500 mb-3">Empresas por Segmento</p>
        <div class="flex flex-col sm:flex-row items-center gap-6">
          <div class="relative flex-shrink-0">
            <svg id="donutSvg" width="160" height="160" viewBox="0 0 160 160"></svg>
            <div class="absolute inset-0 flex items-center justify-center">
              <span id="donutCenter" class="text-2xl font-bold text-gray-800">—</span>
            </div>
          </div>
          <div id="donutLegend" class="flex-1 grid grid-cols-2 gap-x-4 gap-y-1.5">
            <p class="text-xs text-gray-400">Carregando...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabela de registros -->
    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
      <div class="px-5 py-4 border-b border-gray-100 flex items-center justify-between">
        <h2 class="font-semibold text-gray-800">Registros de Lojistas</h2>
        <div class="flex items-center gap-2">
          <a href="cadastro.html" class="sm:hidden text-sm text-white bg-indigo-600 hover:bg-indigo-700 font-medium px-3 py-1.5 rounded-lg transition">+ Novo</a>
          <button onclick="loadRegistros()"
            class="text-sm text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-1 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
            </svg>
            Atualizar
          </button>
        </div>
      </div>

      <div id="tableBody">
        <div class="flex items-center justify-center py-12 text-gray-400">
          <svg class="animate-spin w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 22 6.477 22 12h-4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Carregando...
        </div>
      </div>
    </div>
  </main>

  <script>
    const token = sessionStorage.getItem('bb_token');
    const nome  = sessionStorage.getItem('bb_nome')  || '';
    const email = sessionStorage.getItem('bb_email') || '';

    if (!token) {
      window.location.href = 'login.html';
    }

    document.getElementById('userNome').textContent  = nome || email;
    document.getElementById('userEmail').textContent = email;

    // Cores por segmento (hex)
    const segHex = {
      'Eletronicos':      '#3b82f6',
      'Moda':             '#ec4899',
      'Alimentos':        '#22c55e',
      'Saude e Beleza':   '#a855f7',
      'Casa e Decoracao': '#f59e0b',
      'Esportes':         '#ef4444',
      'Automotivo':       '#6b7280',
      'Brinquedos':       '#eab308',
      'Livros':           '#06b6d4',
      'Outros':           '#94a3b8',
    };

    function renderSegmentos(registros) {
      const svg = document.getElementById('donutSvg');
      const legend = document.getElementById('donutLegend');
      const center = document.getElementById('donutCenter');

      if (!registros.length) {
        svg.innerHTML = '';
        legend.innerHTML = '<p class="text-xs text-gray-400 col-span-2">Nenhum registro.</p>';
        center.textContent = '0';
        return;
      }

      // Contar
      const counts = {};
      registros.forEach(r => { const s = r.segmento || 'Outros'; counts[s] = (counts[s] || 0) + 1; });
      const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
      const total = registros.length;

      // Centro
      center.textContent = total;

      // Donut SVG
      const cx = 80, cy = 80, r = 60, strokeW = 24;
      const circumference = 2 * Math.PI * r;
      let offset = 0;
      let paths = '';

      sorted.forEach(([seg, count]) => {
        const pct = count / total;
        const dash = pct * circumference;
        const gap = circumference - dash;
        const color = segHex[seg] || '#94a3b8';
        paths += '<circle cx="' + cx + '" cy="' + cy + '" r="' + r + '" ' +
          'fill="none" stroke="' + color + '" stroke-width="' + strokeW + '" ' +
          'stroke-dasharray="' + dash.toFixed(2) + ' ' + gap.toFixed(2) + '" ' +
          'stroke-dashoffset="-' + offset.toFixed(2) + '" ' +
          'transform="rotate(-90 ' + cx + ' ' + cy + ')" ' +
          'style="transition: stroke-dasharray 0.5s, stroke-dashoffset 0.5s"' +
          '/>';
        offset += dash;
      });

      svg.innerHTML = paths;

      // Legenda
      legend.innerHTML = sorted.map(([seg, count]) => {
        const pct = Math.round((count / total) * 100);
        const color = segHex[seg] || '#94a3b8';
        return '<div class="flex items-center gap-2">' +
          '<span class="w-3 h-3 rounded-full flex-shrink-0" style="background:' + color + '"></span>' +
          '<span class="text-xs text-gray-700 truncate">' + seg + '</span>' +
          '<span class="text-xs font-semibold text-gray-500 ml-auto">' + count + ' <span class="text-gray-400 font-normal">(' + pct + '%)</span></span>' +
        '</div>';
      }).join('');
    }

    // Check for success message from cadastro
    const msg = sessionStorage.getItem('bb_success_msg');
    if (msg) {
      document.getElementById('successMsg').textContent = msg;
      document.getElementById('successAlert').classList.remove('hidden');
      sessionStorage.removeItem('bb_success_msg');
      setTimeout(() => document.getElementById('successAlert').classList.add('hidden'), 5000);
    }

    function toggleMobileMenu() {
      document.getElementById('mobileMenu').classList.toggle('hidden');
    }

    async function loadRegistros() {
      const body = document.getElementById('tableBody');
      body.innerHTML = '<div class="flex items-center justify-center py-12 text-gray-400"><svg class="animate-spin w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 22 6.477 22 12h-4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Carregando...</div>';

      try {
        const res  = await fetch('registros', {
          headers: { 'Authorization': 'Bearer ' + token },
        });
        const data = await res.json();

        if (!data.success) {
          if (res.status === 401) {
            sessionStorage.clear();
            window.location.href = 'login.html';
            return;
          }
          body.innerHTML = '<div class="px-5 py-8 text-center text-sm text-red-600">' + data.message + '</div>';
          return;
        }

        const registros = data.data || [];
        document.getElementById('totalRegistros').textContent = registros.length;
        renderSegmentos(registros);

        if (registros.length === 0) {
          body.innerHTML = '<div class="px-5 py-12 text-center"><p class="text-sm text-gray-400 mb-4">Nenhum registro encontrado.</p><a href="cadastro.html" class="inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold rounded-lg transition">+ Novo Cadastro</a></div>';
          return;
        }

        const rows = registros.map(r => `
          <tr class="border-t border-gray-100 hover:bg-gray-50 transition">
            <td class="px-4 py-3 text-sm text-gray-600">${r.id}</td>
            <td class="px-4 py-3 text-sm font-medium text-gray-800">${esc(r.razao_social || r.resp_nome || '—')}</td>
            <td class="px-4 py-3 text-sm text-gray-600 hidden sm:table-cell">${esc(r.nome_fantasia || '—')}</td>
            <td class="px-4 py-3"><span class="px-2 py-0.5 rounded text-xs font-semibold ${r.tipo_pessoa === 'PJ' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}">${esc(r.tipo_pessoa || '—')}</span></td>
            <td class="px-4 py-3 text-sm text-gray-600 hidden md:table-cell">${esc(r.resp_email || '—')}</td>
            <td class="px-4 py-3">
              <div class="flex items-center gap-1">
                <a href="cadastro.html?id=${r.id}" title="Editar"
                  class="p-1.5 rounded-lg text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 transition">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                  </svg>
                </a>
                <button onclick="deleteRegistro(${r.id}, '${esc(r.razao_social || r.resp_nome || 'este registro')}')" title="Excluir"
                  class="p-1.5 rounded-lg text-gray-400 hover:text-red-600 hover:bg-red-50 transition">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        `).join('');

        body.innerHTML = `
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="text-left text-xs font-medium text-gray-500 uppercase tracking-wide bg-gray-50">
                  <th class="px-4 py-3">ID</th>
                  <th class="px-4 py-3">Razão Social / Nome</th>
                  <th class="px-4 py-3 hidden sm:table-cell">Nome Fantasia</th>
                  <th class="px-4 py-3">Tipo</th>
                  <th class="px-4 py-3 hidden md:table-cell">E-mail Responsável</th>
                  <th class="px-4 py-3">Ações</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>`;
      } catch {
        body.innerHTML = '<div class="px-5 py-8 text-center text-sm text-red-600">Erro de conexão. O servidor está em execução?</div>';
      }
    }

    function esc(str) {
      const d = document.createElement('div');
      d.textContent = str;
      return d.innerHTML;
    }

    async function deleteRegistro(id, nome) {
      if (!confirm('Deseja excluir o registro "' + nome + '"?')) return;

      try {
        const res = await fetch('registros/' + id, {
          method: 'DELETE',
          headers: { 'Authorization': 'Bearer ' + token },
        });
        const data = await res.json();

        if (res.status === 401) {
          sessionStorage.clear();
          window.location.href = 'login.html';
          return;
        }

        if (data.success) {
          loadRegistros();
        } else {
          alert(data.message || 'Erro ao excluir registro.');
        }
      } catch {
        alert('Erro de conexão.');
      }
    }

    async function logout() {
      try {
        await fetch('logout', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + token },
        });
      } finally {
        sessionStorage.clear();
        window.location.href = 'login.html';
      }
    }

    loadRegistros();
  </script>
</body>
</html>
