{
  "info": {
    "_postman_id": "buscabusca-api-v1",
    "name": "BuscaBusca API REST",
    "description": "Coleção de endpoints da API REST BuscaBusca — Teste Técnico Adianti + SQLite\n\n**Como usar:**\n1. Importe esta coleção no Postman\n2. Execute `POST /login` para obter o token (salvo automaticamente em `{{token}}`)\n3. As demais requests já usam `{{token}}` no header Authorization\n4. Execute `POST /registros` para criar um lojista (ID salvo em `{{registro_id}}`)\n5. Use `PUT` e `DELETE` com `{{registro_id}}`\n6. Execute `POST /logout` ao final para invalidar o token\n\n**Segurança:** token válido por 1 hora. Logout revoga imediatamente.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8090",
      "type": "string",
      "description": "URL base da API. Altere para o servidor desejado."
    },
    {
      "key": "token",
      "value": "",
      "type": "string",
      "description": "Token gerado pelo POST /login (preenchido automaticamente). Válido por 1 hora."
    },
    {
      "key": "registro_id",
      "value": "",
      "type": "string",
      "description": "ID do lojista criado pelo POST /registros (preenchido automaticamente)."
    }
  ],
  "item": [
    {
      "name": "Autenticação",
      "item": [
        {
          "name": "POST /login — Credenciais corretas",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var json = pm.response.json();",
                  "if (json.success && json.data && json.data.token) {",
                  "    pm.collectionVariables.set('token', json.data.token);",
                  "    console.log('Token salvo:', json.data.token.substring(0, 20) + '...');",
                  "}",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('success = true', () => pm.expect(json.success).to.be.true);",
                  "pm.test('Token presente', () => pm.expect(json.data.token).to.exist);",
                  "pm.test('expira_em presente', () => pm.expect(json.data.expira_em).to.exist);",
                  "pm.test('usuario.id presente', () => pm.expect(json.data.usuario.id).to.exist);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@buscabusca.com\",\n  \"senha\": \"123456\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/login",
              "host": ["{{base_url}}"],
              "path": ["login"]
            },
            "description": "Autentica com credenciais válidas e retorna token de acesso (válido 1 hora).\n\nO token é salvo automaticamente na variável `{{token}}` da coleção."
          },
          "response": [
            {
              "name": "Sucesso",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\"email\":\"admin@buscabusca.com\",\"senha\":\"123456\"}"
                },
                "url": {
                  "raw": "{{base_url}}/login"
                }
              },
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"token\": \"d1ec6230b06cee1b967553e7120c4be1...\",\n    \"expira_em\": \"2026-02-21 09:31:44\",\n    \"usuario\": {\n      \"id\": 1,\n      \"email\": \"admin@buscabusca.com\"\n    }\n  },\n  \"message\": \"Login realizado com sucesso\"\n}"
            }
          ]
        },
        {
          "name": "POST /login — Credenciais inválidas",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var json = pm.response.json();",
                  "pm.test('Status 401', () => pm.response.to.have.status(401));",
                  "pm.test('success = false', () => pm.expect(json.success).to.be.false);",
                  "pm.test('Mensagem genérica (sem detalhes internos)', () => {",
                  "    pm.expect(json.message).to.not.include('Exception');",
                  "    pm.expect(json.message).to.not.include('.php');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@buscabusca.com\",\n  \"senha\": \"senha_errada\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/login",
              "host": ["{{base_url}}"],
              "path": ["login"]
            },
            "description": "Testa rejeição de credenciais inválidas. Deve retornar 401 com mensagem genérica (sem vazar detalhes internos)."
          },
          "response": [
            {
              "name": "Não autorizado",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\"email\":\"admin@buscabusca.com\",\"senha\":\"senha_errada\"}"
                },
                "url": {
                  "raw": "{{base_url}}/login"
                }
              },
              "status": "Unauthorized",
              "code": 401,
              "body": "{\n  \"success\": false,\n  \"message\": \"Credenciais inválidas\"\n}"
            }
          ]
        },
        {
          "name": "POST /logout — Encerrar sessão",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var json = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('success = true', () => pm.expect(json.success).to.be.true);",
                  "// Limpa o token da coleção após logout",
                  "pm.collectionVariables.set('token', '');",
                  "console.log('Token removido da coleção.');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/logout",
              "host": ["{{base_url}}"],
              "path": ["logout"]
            },
            "description": "Invalida o token atual imediatamente. Após esta request, qualquer uso do token retornará 401.\n\nO token é removido da variável `{{token}}` automaticamente pelo script de teste."
          },
          "response": [
            {
              "name": "Sucesso",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/logout"
                }
              },
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"message\": \"Logout realizado com sucesso\"\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "Registros (Lojistas)",
      "item": [
        {
          "name": "GET /registros — Sem token (401)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var json = pm.response.json();",
                  "pm.test('Status 401', () => pm.response.to.have.status(401));",
                  "pm.test('success = false', () => pm.expect(json.success).to.be.false);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/registros",
              "host": ["{{base_url}}"],
              "path": ["registros"]
            },
            "description": "Testa acesso sem token. Deve retornar 401."
          },
          "response": []
        },
        {
          "name": "GET /registros — Listar todos",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var json = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('success = true', () => pm.expect(json.success).to.be.true);",
                  "pm.test('data é array', () => pm.expect(json.data).to.be.an('array'));",
                  "pm.test('Security headers presentes', () => {",
                  "    pm.expect(pm.response.headers.get('X-Content-Type-Options')).to.equal('nosniff');",
                  "    pm.expect(pm.response.headers.get('X-Frame-Options')).to.equal('DENY');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/registros",
              "host": ["{{base_url}}"],
              "path": ["registros"]
            },
            "description": "Lista os lojistas do usuário autenticado. Requer token.\n\nApenas registros criados pelo usuário dono do token são retornados (filtro por user_id)."
          },
          "response": [
            {
              "name": "Sucesso",
              "originalRequest": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/registros"
                }
              },
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": [\n    {\n      \"id\": 1,\n      \"tipo_pessoa\": \"PJ\",\n      \"cnpj\": \"12.345.678/0001-99\",\n      \"razao_social\": \"Empresa Exemplo LTDA\",\n      \"nome_fantasia\": \"Loja Exemplo\",\n      \"aceite_termos\": true,\n      \"aceite_veracidade\": true,\n      \"user_id\": 1\n    }\n  ],\n  \"message\": \"1 registro(s) encontrado(s)\"\n}"
            }
          ]
        },
        {
          "name": "POST /registros — Criar lojista",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var json = pm.response.json();",
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "pm.test('success = true', () => pm.expect(json.success).to.be.true);",
                  "pm.test('id presente', () => pm.expect(json.data.id).to.exist);",
                  "pm.test('user_id presente', () => pm.expect(json.data.user_id).to.exist);",
                  "if (json.data && json.data.id) {",
                  "    pm.collectionVariables.set('registro_id', json.data.id);",
                  "    console.log('registro_id salvo:', json.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tipo_pessoa\": \"PJ\",\n  \"cnpj\": \"12.345.678/0001-99\",\n  \"razao_social\": \"Empresa Exemplo LTDA\",\n  \"nome_fantasia\": \"Loja Exemplo\",\n  \"data_abertura\": \"2020-01-15\",\n  \"capital_social\": 50000.00,\n  \"regime_tributario\": \"Simples Nacional\",\n  \"inscricao_estadual\": \"123456789\",\n  \"resp_nome\": \"João Silva\",\n  \"resp_cpf\": \"123.456.789-00\",\n  \"resp_email\": \"joao@exemplo.com\",\n  \"resp_telefone\": \"(11) 99999-0000\",\n  \"segmento\": \"Eletronicos\",\n  \"descricao_produtos\": \"Smartphones e acessórios\",\n  \"origem_produtos\": \"Nacional\",\n  \"produtos_restritos\": false,\n  \"possui_loja\": true,\n  \"possui_estoque\": true,\n  \"estoque_cep\": \"01310-100\",\n  \"estoque_endereco\": \"Av. Paulista, 1000\",\n  \"logistica_envio\": \"Vendedor\",\n  \"emissao_nf\": \"NF-e\",\n  \"banco\": \"Itaú\",\n  \"agencia\": \"1234\",\n  \"conta\": \"56789-0\",\n  \"tipo_conta\": \"Corrente\",\n  \"volume_pedidos\": \"ate50\",\n  \"aceite_termos\": true,\n  \"aceite_veracidade\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/registros",
              "host": ["{{base_url}}"],
              "path": ["registros"]
            },
            "description": "Cria um novo lojista com todos os 26 campos. Requer token.\n\nCampos obrigatórios: `tipo_pessoa`, `resp_nome`, `resp_email`, `aceite_termos`, `aceite_veracidade`.\n\nO ID criado é salvo em `{{registro_id}}` automaticamente.\nO `user_id` é definido pelo servidor com base no token — não pode ser informado no body."
          },
          "response": []
        },
        {
          "name": "PUT /registros/{id} — Atualizar lojista",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var json = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('success = true', () => pm.expect(json.success).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nome_fantasia\": \"Loja Atualizada\",\n  \"segmento\": \"Moda\",\n  \"volume_pedidos\": \"ate200\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/registros/{{registro_id}}",
              "host": ["{{base_url}}"],
              "path": ["registros", "{{registro_id}}"]
            },
            "description": "Atualiza campos de um lojista existente. Requer token.\n\nSó é possível atualizar registros criados pelo próprio usuário. Tentativas de atualizar registros de outros usuários retornam 404."
          },
          "response": []
        },
        {
          "name": "PUT /registros/999 — ID inexistente (404)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var json = pm.response.json();",
                  "pm.test('Status 404', () => pm.response.to.have.status(404));",
                  "pm.test('success = false', () => pm.expect(json.success).to.be.false);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nome_fantasia\": \"Nao existe\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/registros/999",
              "host": ["{{base_url}}"],
              "path": ["registros", "999"]
            },
            "description": "Testa atualização de ID inexistente (ou de outro usuário). Deve retornar 404."
          },
          "response": []
        },
        {
          "name": "DELETE /registros/{id} — Remover lojista",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var json = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('success = true', () => pm.expect(json.success).to.be.true);",
                  "pm.collectionVariables.set('registro_id', '');",
                  "console.log('registro_id limpo.');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/registros/{{registro_id}}",
              "host": ["{{base_url}}"],
              "path": ["registros", "{{registro_id}}"]
            },
            "description": "Remove um lojista pelo ID. Requer token.\n\nSó é possível remover registros criados pelo próprio usuário."
          },
          "response": []
        },
        {
          "name": "DELETE /registros/999 — ID inexistente (404)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var json = pm.response.json();",
                  "pm.test('Status 404', () => pm.response.to.have.status(404));",
                  "pm.test('success = false', () => pm.expect(json.success).to.be.false);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/registros/999",
              "host": ["{{base_url}}"],
              "path": ["registros", "999"]
            },
            "description": "Testa remoção de ID inexistente (ou de outro usuário). Deve retornar 404."
          },
          "response": []
        }
      ]
    }
  ]
}
